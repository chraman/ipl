<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Models - Recline Data Explorer and Library</title>

  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="../vendor/bootstrap/2.0.2/css/bootstrap.css" />

  

  <!-- link rel="stylesheet" href="vendor/bootstrap/2.0.2/css/bootstrap-responsive.css" -->

  <link href="../css-site/pygments.css" rel="stylesheet" type="text/css" />
  <link href="../css-site/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="logo-icon pull-left" href="/">
        <img src="http://assets.okfn.org/p/recline/img/chair.png" />
      </a>
      <a class="brand" href="../"><strong>Recline.js</strong> &ndash; relax with your data</a>
      <ul class="nav">
        <li>
          <a href="../docs/">
            <i class="icon-book icon-white"></i>
            Documentation
          </a>
        </li>
        <li class="divider-vertical"></li>
        <li>
          <a href="../docs/tutorials.html">
            <i class="icon-road icon-white"></i>
            Tutorials
          </a>
        </li>
        <li class="divider-vertical"></li>
        <li>
          <a href="../demos/">
            <i class="icon-pencil icon-white"></i>
            Demos
          </a>
        </li>
        <li class="divider-vertical"></li>
        <li>
          <a href="../download.html">
            <i class="icon-download-alt icon-white"></i>
            Download
          </a>
        </li>
      </ul>
      <ul class="nav pull-right">
        <li>
          <a href="http://github.com/okfn/recline/">
            <i class="icon-download-alt icon-white"></i>
            GitHub
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

<div class="container">
  <div class='page-header'>
  <h1>
    Models
  </h1>
</div>
<p>Models help you structure your work with data by providing several objects and functions. The key ones are Dataset and Record &#8211; a Dataset being a collection of Records. Additionally, there is a a Field object for describing the columns of a Dataset, a Query object for describing queries, and a Facet object for holding summary information about a Field (or multiple Fields).</p>

<p>All the models are Backbone models, that is they extend Backbone.Model. Note, however, that they do not &#8216;sync&#8217; (load/save) like normal Backbone models.</p>
<h2 id='dataset'>Dataset</h2>
<p>A Dataset is <em>the</em> central object in Recline. Standard usage is:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>dataset</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>recline</span><span class='p'>.</span><span class='nx'>model</span><span class='p'>.</span><span class='nx'>Dataset</span><span class='p'>({</span>
  <span class='c1'>// general metadata e.g. </span>
  <span class='nx'>id</span><span class='o'>:</span> <span class='p'>...</span>
  <span class='nx'>title</span><span class='o'>:</span> <span class='p'>...</span>
  <span class='c1'>// information about data source e.g.</span>
  <span class='nx'>url</span><span class='o'>:</span> <span class='nx'>http</span><span class='o'>:</span><span class='c1'>//url.to.my.data.endpoint/</span>
  <span class='c1'>// backend string or object</span>
  <span class='nx'>backend</span><span class='o'>:</span> <span class='nx'>a</span> <span class='nx'>string</span> <span class='nx'>identifying</span> <span class='nx'>the</span> <span class='nx'>backend</span> <span class='nx'>we</span> <span class='nx'>are</span> <span class='nx'>using</span> <span class='o'>-</span> <span class='nx'>see</span> <span class='nx'>below</span>
<span class='p'>});</span>

<span class='c1'>// initialize dataset with data from the backend.</span>
<span class='nx'>dataset</span><span class='p'>.</span><span class='nx'>fetch</span><span class='p'>();</span>

<span class='c1'>// we will now have the following (and more) set up - see below for details </span>
<span class='nx'>dataset</span><span class='p'>.</span><span class='nx'>fields</span> <span class='c1'>// collection of Fields (columns) for this Dataset</span>
<span class='nx'>dataset</span><span class='p'>.</span><span class='nx'>records</span> <span class='c1'>// collection of Records resulting from latest query</span>
<span class='nx'>dataset</span><span class='p'>.</span><span class='nx'>docCount</span> <span class='c1'>// total number of Records in the last query</span>
</code></pre>
</div>
<h3 id='key_attributes'>Key Attributes</h3>

<ul>
<li>records: a collection of <code>Record</code>s currently loaded for viewing (updated by calling query method) - note that this need <strong>not</strong> be all the records in the dataset (for example, you may have connected to a source where the complete dataset contains a million records but you have only loaded a 1000 records)</li>

<li>fields: (aka columns) is a Backbone collectoin of <code>Field</code>s listing all the fields on this Dataset (this can be set explicitly, or, will be set by Dataset.fetch()</li>

<li>docCount: total number of records in this dataset</li>

<li>backend: the Backend (instance) for this Dataset. (NB: this is a the backend attribute on the object itself not the backend in the Backbone attributes i.e. the result of dataset.get(&#8216;backend&#8217;). The latter is a string identifying the backend.</li>

<li>queryState: a <code>Query</code> object which stores current queryState. queryState may be edited by other components (e.g. a query editor view) changes will trigger a Dataset query.</li>

<li>facets: a collection of <code>Facet</code>s</li>
</ul>

<h3 id='querying'>Querying</h3>
<div class='highlight'><pre><code class='javascript'><span class='nx'>dataset</span><span class='p'>.</span><span class='nx'>query</span><span class='p'>(</span><span class='nx'>queryObj</span><span class='p'>)</span>
</code></pre>
</div>
<p><code>queryObj</code> is an object following the <a href='#query-structure'>query
specification below</a>.</p>
<h2 id='record'>Record (aka Row)</h2>
<p>A Record is a single entry or row in a dataset. A Record needs little more than what is provided by the standard Backbone Model object. In general, you will never create a Record directly &#8211; they will get created for you by Datasets from query results.</p>
<h2 id='field'>Field (aka Column)</h2>
<p>A Field should have the following attributes as standard:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>field</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Field</span><span class='p'>({</span>
  <span class='c1'>// a unique identifer for this field- usually this should match the key in the records hash</span>
  <span class='nx'>id</span><span class='o'>:</span> <span class='s1'>&#39;my-field-id&#39;</span>

  <span class='c1'>// (optional: defaults to id) the visible label used for this field</span>
  <span class='nx'>label</span><span class='o'>:</span> <span class='s1'>&#39;My Field Name&#39;</span><span class='p'>,</span>

  <span class='c1'>// (optional: defaults to string) the type of the data in this field.</span>
  <span class='c1'>// For list of type names see below</span>
  <span class='nx'>type</span><span class='o'>:</span> <span class='s1'>&#39;string&#39;</span><span class='p'>,</span>

  <span class='c1'>// (optional - defaults to null) used to indicate how the data should be</span>
  <span class='c1'>// formatted. See below.</span>
  <span class='nx'>format</span><span class='o'>:</span> <span class='kc'>null</span><span class='p'>,</span>

  <span class='c1'>// (default: false) attribute indicating this field has no backend data but</span>
  <span class='c1'>// is just derived from other fields (see below).</span>
  <span class='nx'>is_derived</span><span class='o'>:</span> <span class='kc'>false</span>
</code></pre>
</div>
<h4 id='types'>Types</h4>

<p>The type attribute is a string indicating the type of this field.</p>

<p>Types are based on the <a href='http://tools.ietf.org/html/draft-zyp-json-schema-03#section-5.1'>type set of json-schmea</a> with a few minor additions and modifications (cf other type lists include those in <a href='es-types'>Elasticsearch</a>).</p>

<p>The type list is as follows (brackets indicate possible aliases for specific types - these types will be recognized and normalized to the default type name for that type):</p>

<ul>
<li>string (text) - a string</li>

<li>number (double, float, numeric) - a number including floating point numbers.</li>

<li>integer (int) - an integer.</li>

<li>date - a date. The preferred format is YYYY-MM-DD.</li>

<li>time - a time without a date</li>

<li>date-time (datetime, timestamp) a date-time. It is recommended this be in ISO 8601 format of YYYY-MM- DDThh:mm:ssZ in UTC time.</li>

<li>boolean (bool)</li>

<li>binary - base64 representation of binary data.</li>

<li>geo_point</li>

<li>geojson</li>

<li>array</li>

<li>object (json)</li>

<li>any - value of field may be any type</li>
</ul>
<div class='alert'>NB: types are not validated so you can set the type to
whatever value you like (it does not have to be in the above list). However,
using types outside of the specified list may limit functionality.</div>
<h4 id='rendering_types_and_formats'>Rendering, types and formats</h4>

<p>One can customize the rendering of fields in the user interface and elsewhere by setting a renderer function on the field. You do this by setting a field attribute:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>myfield</span><span class='p'>.</span><span class='nx'>renderer</span> <span class='o'>=</span> <span class='nx'>myRenderFunction</span><span class='p'>;</span>
</code></pre>
</div>
<p>Your renderer function should have the following signature:</p>

<pre><code>function(value, field, record)</code></pre>

<p>Where the arguments passed in are as follows:</p>

<ul>
<li><code>value</code>: the value of the cell (record value for this field)</li>

<li><code>field</code>: corresponding <code>Field</code> object</li>

<li><code>record</code>: is the <code>Record</code> object (as simple JS object)</li>
</ul>

<p>Note that implementing functions can ignore arguments (e.g. function(value) would be a valid formatter function).</p>

<p>To guide the behaviour of renderers we have type and format information. Example types and formats are:</p>

<ul>
<li>type=date, format=yyyy-mm-dd</li>

<li>type=float, format=percentage</li>

<li>type=string, format=markdown (render as markdown if Showdown available)</li>
</ul>

<p>Default renderers are provided - see the source for details, but a few examples are:</p>

<ul>
<li>
<p>type = string</p>

<ul>
<li>no format provided: pass through but convert http:// to hyperlinks</li>

<li>format = plain: do no processing on the source text</li>

<li>format = markdown: process as markdown (if Showdown library available)</li>
</ul>
</li>

<li>
<p>type = float</p>

<ul>
<li>format = percentage: format as a percentage</li>
</ul>
</li>
</ul>

<h4 id='derived_fields'>Derived fields</h4>

<p>Some fields may be &#8216;dervied&#8217; from other fields. This allows you to define an entirely new value for data in this field. This provides support for a) &#8216;derived/computed&#8217; fields: i.e. fields whose data are functions of the data in other fields b) transforming the value of this field prior to rendering.</p>

<p>To use derived fields set a <code>deriver</code> function on the Field. This function will be used to derive/compute the value of data in this field as a function of this field&#8217;s value (if any) and the current record. It&#8217;s signature and behaviour is the same as for renderer.</p>
<h2 id='query'>Query</h2>
<p>Query instances encapsulate a query to the backend (see <a href='backend/base.html'>query method on backend</a>). Useful both for creating queries and for storing and manipulating query state - e.g. from a query editor).</p>
<h3 id='query-structure'>Query Structure and format</h3>
<p>Query structure should follow that of <a href='http://www.elasticsearch.org/guide/reference/api/search/'>ElasticSearch query language</a>.</p>

<p><strong>NB: It is up to specific backends how to implement and support this query structure. Different backends might choose to implement things differently or not support certain features. Please check your backend for details.</strong></p>

<p>Query object has the following key attributes:</p>

<ul>
<li>size (=limit): number of results to return</li>

<li>from (=offset): offset into result set - http://www.elasticsearch.org/guide/reference/api/search/from-size.html</li>

<li>sort: sort order - see below</li>

<li>query: Query in ES Query DSL <a href='http://www.elasticsearch.org/guide/reference/api/search/query.html'>http://www.elasticsearch.org/guide/reference/api/search/query.html</a></li>

<li>filter: See filters and <a href='http://www.elasticsearch.org/guide/reference/query-dsl/filtered-query.html'>Filtered Query</a></li>

<li>fields: set of fields to return - http://www.elasticsearch.org/guide/reference/api/search/fields.html</li>

<li>facets: specification of facets - see http://www.elasticsearch.org/guide/reference/api/search/facets/</li>
</ul>

<p>Additions:</p>

<ul>
<li>
<p>q: either straight text or a hash will map directly onto a <a href='http://www.elasticsearch.org/guide/reference/query-dsl/query-string-query.html'>query_string query</a> in backend</p>

<ul>
<li>Of course this can be re-interpreted by different backends. E.g. some may just pass this straight through e.g. for an SQL backend this could be the full SQL query</li>
</ul>
</li>

<li>
<p>filters: array of ElasticSearch filters. These will be and-ed together for execution.</p>
</li>
</ul>

<h4 id='sort'>Sort</h4>

<p>Sort structure is inspired by <a href='http://www.elasticsearch.org/guide/reference/api/search/sort.html'>http://www.elasticsearch.org/guide/reference/api/search/sort.html</a> but with some standardization.</p>

<p>Sort structure must be as follows:</p>

<pre><code>&quot;sort&quot; : [
      { field: &quot;post_date&quot;,  &quot;order&quot; : &quot;desc&quot;},
      { field: &quot;user&quot; },
      { &quot;name&quot; : &quot;desc&quot; },
      { &quot;age&quot; : &quot;desc&quot; },
      {&quot;_score&quot;: null}
  ]</code></pre>

<p>If order is omitted it is assumed to be &#8220;desc&#8221; except in the case of <em>score.</em>score is a special case which is used for match score if that is supported by the backend.</p>

<h4 id='examples'>Examples</h4>
<pre>
{
   q: 'quick brown fox',
   filters: [
     { term: { 'owner': 'jones' } }
   ]
}
</pre><h2>Facet <small>&ndash; Summary information (e.g. values and counts) about a field obtained by a 'faceting' or 'group by' method</small>
</h2>
<p>Structure of a facet follows that of Facet results in ElasticSearch, see: <a href='http://www.elasticsearch.org/guide/reference/api/search/facets/'>http://www.elasticsearch.org/guide/reference/api/search/facets/</a></p>

<p>Specifically the object structure of a facet looks like (there is one addition compared to ElasticSearch: the &#8220;id&#8221; field which corresponds to the key used to specify this facet in the facet query):</p>
<div class='highlight'><pre><code class='javascript'><span class='p'>{</span>
  <span class='nx'>id</span><span class='o'>:</span> <span class='s2'>&quot;id-of-facet&quot;</span><span class='p'>,</span>
  <span class='c1'>// type of this facet (terms, range, histogram etc)</span>
  <span class='nx'>_type</span> <span class='o'>:</span> <span class='s2'>&quot;terms&quot;</span><span class='p'>,</span>
  <span class='c1'>// total number of tokens in the facet</span>
  <span class='nx'>total</span><span class='o'>:</span> <span class='mi'>5</span><span class='p'>,</span>
  <span class='c1'>// @property {number} number of records which have no value for the field</span>
  <span class='nx'>missing</span> <span class='o'>:</span> <span class='mi'>0</span><span class='p'>,</span>
  <span class='c1'>// number of facet values not included in the returned facets</span>
  <span class='nx'>other</span><span class='o'>:</span> <span class='mi'>0</span><span class='p'>,</span>
  <span class='c1'>// term object ({term: , count: ...})</span>
  <span class='nx'>terms</span><span class='o'>:</span> <span class='p'>[</span> <span class='p'>{</span>
      <span class='s2'>&quot;term&quot;</span> <span class='o'>:</span> <span class='s2'>&quot;foo&quot;</span><span class='p'>,</span>
      <span class='s2'>&quot;count&quot;</span> <span class='o'>:</span> <span class='mi'>2</span>
    <span class='p'>},</span> <span class='p'>{</span>
      <span class='s2'>&quot;term&quot;</span> <span class='o'>:</span> <span class='s2'>&quot;bar&quot;</span><span class='p'>,</span>
      <span class='s2'>&quot;count&quot;</span> <span class='o'>:</span> <span class='mi'>2</span>
    <span class='p'>},</span> <span class='p'>{</span>
      <span class='s2'>&quot;term&quot;</span> <span class='o'>:</span> <span class='s2'>&quot;baz&quot;</span><span class='p'>,</span>
      <span class='s2'>&quot;count&quot;</span> <span class='o'>:</span> <span class='mi'>1</span>
    <span class='p'>}</span>
  <span class='p'>]</span>
<span class='p'>}</span>
</code></pre>
</div>
</div>



<section class="footer">
	<div class="container">
    <div class="row">
      <div class="span4">
        <p class="getit-btn"><a href="../docs/" class="btn">Use the Library &raquo;</a></p>
        <p>Recline.js is freely redistributable under the terms of the MIT license.</p>
      </div>
      <div class="span3">
        <p><a href="http://www.shuttleworthfoundation.org/"><img src="http://farm8.staticflickr.com/7019/6467412887_18f72f5066_n.jpg" style="width: 140px;" alt="Supported by funding from the Shuttleworth Foundation" /></a></p>
        <ul>
          <li><a href="http://datahub.io/">The DataHub</a></li>
          <li><a href="http://OpenSpending.org/">OpenSpending.org</a></li>
          <li><a href="http://datacouch.com/">DataCouch.com</a></li>
        </ul>
      </div>
      <div class="span3">
        <ul>
          <li><a href="http://okfnlabs.org/">Open Knowledge Foundation Labs</a></li>
          <li><a href="http://opendefinition.org/">Open Definition</a></li>
          <li><a href="http://okfn.org/">Open Knowledge Foundation</a></li>
        </ul>
      </div>
      <div class="span2">
        <h5>Contacts</h5>
        <ul style="list-style-type: none; margin-left: 0;">
          <li><a href="http://twitter.com/ReclineJS">@ReclineJS</a></li>
          <li><a href="http://twitter.com/maxogden">@maxogden</a></li>
          <li><a href="http://twitter.com/rufuspollock">@rufuspollock</a></li>
        </ul>
        <a class="nav-logo" href="http://okfn.org/" title="An Open Knowledge Foundation Project">
          <img src="http://assets.okfn.org/p/okfn/img/logo_28x30.png" alt="Open Knowledge Foundation logo" />
        </a>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-8271754-44']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
