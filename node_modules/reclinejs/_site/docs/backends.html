<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Backends - Recline Data Explorer and Library</title>

  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="../vendor/bootstrap/2.0.2/css/bootstrap.css" />

  

  <!-- link rel="stylesheet" href="vendor/bootstrap/2.0.2/css/bootstrap-responsive.css" -->

  <link href="../css-site/pygments.css" rel="stylesheet" type="text/css" />
  <link href="../css-site/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="logo-icon pull-left" href="/">
        <img src="http://assets.okfn.org/p/recline/img/chair.png" />
      </a>
      <a class="brand" href="../"><strong>Recline.js</strong> &ndash; relax with your data</a>
      <ul class="nav">
        <li>
          <a href="../docs/">
            <i class="icon-book icon-white"></i>
            Documentation
          </a>
        </li>
        <li class="divider-vertical"></li>
        <li>
          <a href="../docs/tutorials.html">
            <i class="icon-road icon-white"></i>
            Tutorials
          </a>
        </li>
        <li class="divider-vertical"></li>
        <li>
          <a href="../demos/">
            <i class="icon-pencil icon-white"></i>
            Demos
          </a>
        </li>
        <li class="divider-vertical"></li>
        <li>
          <a href="../download.html">
            <i class="icon-download-alt icon-white"></i>
            Download
          </a>
        </li>
      </ul>
      <ul class="nav pull-right">
        <li>
          <a href="http://github.com/okfn/recline/">
            <i class="icon-download-alt icon-white"></i>
            GitHub
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

<div class="container">
  <div class='page-header'>
  <h1>
    Backends
    <small>Connect to data sources</small>
  </h1>
</div>
<p>Backends connect Dataset and Documents to data from a specific &#8216;Backend&#8217; data source. They provide methods for loading and saving Datasets and individuals Documents as well as for bulk loading via a query API and doing bulk transforms on the backend.</p>

<p>Backends come in 2 flavours:</p>

<ol>
<li>Loader backends - only implement fetch method. The data is then cached in a Memory.Store on the Dataset and interacted with there. This is best for sources which just allow you to load data or where you want to load the data once and work with it locally.</li>

<li>Store backends - these support fetch, query and, if write-enabled, save. These are suitable where the backend contains a lot of data (infeasible to load locally - for examples a million rows) or where the backend has capabilities you want to take advantage of.</li>
</ol>

<h1 id='backend_api'>Backend API</h1>

<p>Backend modules must implement the following API:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>__type__</span><span class='o'>:</span> <span class='s1'>&#39;name-of-backend&#39;</span> <span class='c1'>// e.g. elasticsearch</span>

<span class='c1'>// Initial load of dataset including initial set of records</span>
<span class='nx'>fetch</span><span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>dataset</span><span class='p'>)</span>

<span class='c1'>// Query the backend for records returning them in bulk.</span>
<span class='c1'>// This method will be used by the Dataset.query method to search the backend</span>
<span class='c1'>// for records, retrieving the results in bulk.</span>
<span class='nx'>query</span><span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>queryObj</span><span class='p'>,</span> <span class='nx'>dataset</span><span class='p'>)</span>

<span class='c1'>// Save changes to the backend</span>
<span class='nx'>save</span><span class='o'>:</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>changes</span><span class='p'>,</span> <span class='nx'>dataset</span><span class='p'>)</span>
</code></pre>
</div>
<p>Details of each function below. Note that:</p>

<ul>
<li>
<p>Each backend function takes a dataset object. This is not a Dataset object but is simple JS object representation resulting from calling Dataset.toJSON().</p>

<p>It is required because the Dataset attributes contain details of specific backend (e.g. url for ElasticSearch etc).</p>
</li>

<li>
<p>Each function returns a promise API object - that is something conforming to the jquery promise API and, in particular, having a done and fail function.</p>
</li>
</ul>

<h3 id='fetch_functiondataset'>fetch: function(dataset)</h3>

<p>On success, promise callback must return an object with the following structure:</p>
<div class='highlight'><pre><code class='javascript'><span class='p'>{</span>
  <span class='c1'>// (optional) Set of record data</span>
  <span class='c1'>// Either an array of arrays *or* an array of objects corresponding to initial set of records for this object</span>
  <span class='c1'>// May not provided if data only returned by query</span>
  <span class='nx'>records</span><span class='o'>:</span> <span class='p'>[...]</span>

  <span class='c1'>// (optional) Set of field data</span>
  <span class='c1'>// Either an array of string or an array of objects corresponding to Field specification (see `Field` above)</span>
  <span class='nx'>fields</span><span class='o'>:</span> <span class='p'>{</span> <span class='p'>...</span> <span class='p'>}</span> <span class='c1'>// as per recline.Model.Field</span>

  <span class='c1'>// (optional) metadata fields to set on the Dataset object</span>
  <span class='nx'>metadata</span><span class='o'>:</span> <span class='p'>{</span> <span class='nx'>title</span><span class='o'>:</span> <span class='p'>...,</span> <span class='nx'>id</span><span class='o'>:</span> <span class='p'>...</span> <span class='nx'>etc</span> <span class='p'>}</span>

  <span class='c1'>// boolean indicating whether to use a local memory store for managing this dataset</span>
  <span class='nx'>useMemoryStore</span><span class='o'>:</span>
<span class='p'>}</span>
</code></pre>
</div>
<h3 id='query_functionqueryobj_dataset'>query: function(queryObj, dataset)</h3>

<p><code>queryObj</code>: JS object following <a href='models.html#query-structure'>Query specification</a> above.</p>

<h4 id='callbacks'>Callbacks</h4>

<p>On success must return a &#8216;QueryResult&#8217; object which has the following structure:</p>
<div class='highlight'><pre><code class='javascript'><span class='p'>{</span>
  <span class='c1'>// total number of results (can be null)</span>
  <span class='nx'>total</span><span class='o'>:</span> <span class='p'>...</span>

  <span class='c1'>// one entry for each result record</span>
  <span class='nx'>hits</span><span class='o'>:</span> <span class='p'>[</span>
    <span class='p'>{</span>
      <span class='c1'>// JS object that can be used to initialize a Record object</span>
    <span class='p'>}</span> 
  <span class='p'>],</span>

  <span class='c1'>// (optional) </span>
  <span class='nx'>facets</span><span class='o'>:</span> <span class='p'>{</span>
    <span class='c1'>// facet results (as per &lt;http://www.elasticsearch.org/guide/reference/api/search/facets/&gt;)</span>
  <span class='p'>}</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>The QueryResult is partially modelled on ElasticSearch - see <a href='https://github.com/okfn/recline/issues/57'>this issue for more
details</a>.</p>

<h3 id='save_functionchanges_dataset'>save: function(changes, dataset)</h3>
<div class='alert alert-warning'>The save function is still being revised and
its API and arguments are subject to change</div>
<p><code>changes</code>: an object with the following structure:</p>
<div class='highlight'><pre><code class='javascript'><span class='p'>{</span>
  <span class='nx'>creates</span><span class='o'>:</span> <span class='p'>[</span> <span class='nx'>record</span><span class='p'>.</span><span class='nx'>toJSON</span><span class='p'>(),</span> <span class='nx'>record</span><span class='p'>.</span><span class='nx'>toJSON</span><span class='p'>(),</span> <span class='p'>...</span> <span class='p'>]</span>
  <span class='nx'>updates</span><span class='o'>:</span> <span class='p'>[</span> <span class='p'>...</span> <span class='p'>]</span>
  <span class='nx'>deletes</span><span class='o'>:</span> <span class='p'>[</span> <span class='p'>...</span> <span class='p'>]</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>Each key has an array of records (as simple JS objects resulting from a call to Record.toJSON()) that are in that state.</p>

<p>The backend should take appropriate actions for each case.</p>
</div>



<section class="footer">
	<div class="container">
    <div class="row">
      <div class="span4">
        <p class="getit-btn"><a href="../docs/" class="btn">Use the Library &raquo;</a></p>
        <p>Recline.js is freely redistributable under the terms of the MIT license.</p>
      </div>
      <div class="span3">
        <p><a href="http://www.shuttleworthfoundation.org/"><img src="http://farm8.staticflickr.com/7019/6467412887_18f72f5066_n.jpg" style="width: 140px;" alt="Supported by funding from the Shuttleworth Foundation" /></a></p>
        <ul>
          <li><a href="http://datahub.io/">The DataHub</a></li>
          <li><a href="http://OpenSpending.org/">OpenSpending.org</a></li>
          <li><a href="http://datacouch.com/">DataCouch.com</a></li>
        </ul>
      </div>
      <div class="span3">
        <ul>
          <li><a href="http://okfnlabs.org/">Open Knowledge Foundation Labs</a></li>
          <li><a href="http://opendefinition.org/">Open Definition</a></li>
          <li><a href="http://okfn.org/">Open Knowledge Foundation</a></li>
        </ul>
      </div>
      <div class="span2">
        <h5>Contacts</h5>
        <ul style="list-style-type: none; margin-left: 0;">
          <li><a href="http://twitter.com/ReclineJS">@ReclineJS</a></li>
          <li><a href="http://twitter.com/maxogden">@maxogden</a></li>
          <li><a href="http://twitter.com/rufuspollock">@rufuspollock</a></li>
        </ul>
        <a class="nav-logo" href="http://okfn.org/" title="An Open Knowledge Foundation Project">
          <img src="http://assets.okfn.org/p/okfn/img/logo_28x30.png" alt="Open Knowledge Foundation logo" />
        </a>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-8271754-44']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
