var loader = require('./note-load.js');

// removes 'node' and this script
args = process.argv.splice(2);

// Create some fixtures (e.g. for demoing)
if (args && args[0] == 'note-load') {
  if (args.length < 2) {
    console.log('Usage: load {filepath} [{dest}]');
    return;
  }
  var filepath = args[1];
  var dest = args[2];
  loader.load(filepath, dest); 
} else {
  console.log('Commands are:');
  console.log('note-load {path} {dest}');
}


// ========================================================
// library


// upsert to elasticsearc
function upsert(endpoint, doc) {
  var http = require('http');
  var url = require('url');
  var parts = url.parse(endpoint);
  var options = {
    host: parts.hostname,
    path: parts.path,
    port: parts.port,
    method: 'POST'
  };
  console.log(options);

  var req = http.request(options, function(res) {
    console.log('STATUS: ' + res.statusCode);
    console.log('HEADERS: ' + JSON.stringify(res.headers));
    res.setEncoding('utf8');
    res.on('data', function (chunk) {
      console.log('BODY: ' + chunk);
    });
  });
  req.write(JSON.stringify(doc));
  req.end();
}
